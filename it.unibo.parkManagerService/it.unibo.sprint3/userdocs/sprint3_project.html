<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <!--
<link rel="stylesheet" type="text/css" href="../css/issStyle1.css">
<script type="text/javascript" src="../css/issStyle.js"></script>
-->
<style type="text/css">
body
{
    margin-left:  30px;
    margin-right: 30px;
};

P
{
    font-family: Tahoma;
    font-size: 10pt;
};

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
	font-size: 93%;
}

a:hover {
    background-color: #cccccc;
}


hr {
    clear: both;
    height: 1px;
    color: #242424;
    background-color: transparent;
}

h1, h2, h3 {
    color: #242424;
    clear: left;
    font: 100% Tahoma, Helvetica, Arial, sans-serif;
    margin-bottom: 0.5em;
    padding-top: 0.5em;
	border-radius: 10px;
	padding: 5px;
}

top {
	width: 100%;
}


#i {
    color: #ff1010;
}
tt{
	font-family: "Arial";
    font-size: 90%;
	color: #006600;
}
em{
	font-family: "Arial";
    font-size: 80%;
	font-weight: bold;
	border-style:solid;
	border-color: #abe876;
    color: #1632cc;
}
bc{
	font-family: "Arial";
	font-size: 90%;
	font-weight: bold;
    color: #990000;
	background-color: #fcf8c7;
}
ks{
	font-family: "Arial";
	font-weight: bold;
    color: #0000CD	;
	font-size: 90%;
}
kc{
	font-family: "Arial";
	font-weight: bold;
    color: #008000	;
	font-size: 90%;
}
pre{
	font-family: "Consolas";
	font-size: 85%;
	background-color: #f5f5f5;
	border: 1.5px solid silver;
	padding: 5px;
}
m{
	font-family: "Helvetica";
	line-height: 100%;
 	font-size: 75%;
}
div.body{
	 
    font-size: 18px;
}
k{
	font-family: "Arial";
    color: #990000;
	font-weight: bold;
	font-size: 90%;
}
kn{
	font-family: "Arial";
    color: #0000CD	;
	font-size: 90%;
}
h1 {
    font-size: 150%;
    background-color: #b2c0ff;
	padding: 10px;
}

h2 {
    background-color: #9ed8ff;
    font-size: 130%;
}

h3 {
	background-color: #e6ccff;
    font-size: 100%;
}
h4 {
    background-color: #ccffcc;
    font-size: 100%;
	width: 95%;
	border-radius: 5px;
	padding: 2px;
}
h5 {
    background-color: #d5ffb0;
    font-size: 100%;

}

h6 {
    background-color: #d5fff0;
    font-size: 100%;

}
div.req{
	background-color: #d9ffb3;
    font-size: 18px;
	width: 700px;
    border: 3px solid green;
    padding: 15px;
    margin: 10px;
}
div.remark{
	background-color: #E3F2FD;
    border: 1.5px solid #d5f2ed;
    padding: 15px;
    margin: 10px;
	border-radius: 25px;
}
table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
}

ol, ul, li {
  margin: 0;
  margin-left: 10px;
  padding: 0;
  padding-bottom: 5px;
}

table, th, td {
	border: 1px solid black;
}

img {
	border: 1.5px solid #d5f2ed

}

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
}

div.wrapdesc{
	width: 90%;
	margin: auto;
}

div.imagedesc{
	width: 85%;
	margin: auto;
}
</style>
    
<head>
   
<title>Sprint 3</title></head>
    
<body>
<div id="top">
<h1>Workplan Automated Car-Parking- Sprint 3: <font size="5"></font> </h1>
</div>  

<h2>Requirements</h2>

<div class="remark">
The requirements given by the costumers  <a href="https://github.com/anatali/issLab2021/blob/main/it.unibo.issLabStart/userDocs/TFBO21ISS.pdf" target="web">Automated Car-Parking</a> considered in the following SPRINT are:</li>
</div> 
<li>an <em>INDOOR</em> to enter the car in the area. Facing the <tt>INDOOR</tt>, there is
	a <em>INDOOR-area</em> equipped with a <em>weigthsensor</em> that measures the <em>weigth</em> of the car;</li>

	<li>an <em>OUTDOOR</em> to exit from the <tt>parking-area</tt>. Just after the <tt>OUTDOOR</tt>, there is
	<em>OUTDOOR-area</em> equipped with a <em>outsonar</em>, used to detect the presence of a car.
	
</ul>

	<ul>
		<li>a <em>thermometer</em> that measures the temperature <em>TA</em> of the area;</li>
		<li>a <em>fan</em> 
	
	</ul>
	The fan should be activated by ParkManagerService or ParkingManager when <k>TA > TMAX</k> and stopped when <k>TA &lt;= TMAX</k>, where <em>TMAX</em> is a prefixed value (e.g. <tt>35</tt>)</li>

<h3>User stories</h3>
 
<li>
<em>acceptIN</em>: accept the request of a client to park the car if there is at least one <tt>parking-slot</tt> available,
select a free slot identified with a unique <tt>SLOTNUM</tt>.<br/>
A request of this type can be elaborated only when the <k><tt>INDOOR-area</tt> is free</k>, 
If the <tt>INDOOR-area</tt> is already engaged by a car, the request is not immediately processed 
(the client could simply wait or could - optionally - receive a proper notice). 
<br/>
  


<li>
<em>acceptOUT</em>: accept the request of a client to get out the car with <tt>TOKENID</tt>.
A request of this type can be elaborated only when the <k><tt>OUTDOOR-area</tt> is free</k> 
and  the <tt>transport trolley</tt> is at <tt>home</tt> or working (<k>not stopped</k> by the manager).
If the <tt>OUTDOOR-area</tt> is still engaged by a car, the request is not immediately processed 
(the client could simply wait or could - optionally - receive a proper notice).
<h4>About the devices</h4>
All the sensors (<tt>weigthsensor</tt>, <tt>outsonar</tt>, <tt>thermometer</tt> ) and the <tt>fan</tt> should be properly simulated
by mock-objects or mock-actors.

<h4>When available a Raspberry and a sonar</h4>
The <tt>outsonar</tt> could be a real device. We can simulate the presence/absence of a car.
<br><br>


The following sprint will focus to <kn>realize interaction between the parkManagerService and the sensors</kn> and <kn>realize the operations of the fan, thermometer and parkingmanager </kn>.

<h2>Requirement analysis</h2>

	Our interaction with the customer has made it clear what he means for:																<li><kn>INDOOR-area</kn>: the area in front of the parking INDOOR where is the weightsensor and the trasport trolley loads the car;</li>
<li><kn>OUTDOOR-area</kn>: the area in front of the parking OUTDOOR where is the OUTsonar and the trasport trolley releases the car;</li> 
<li><kn>weightsensor</kn>: an simulate device capable of detecting the presence of a car and measuring its weight. It is in the INDOOR-area and sends the information taken via the network as event emitter;</li>

<li><kn>alarm</kn>: a message that has been sent by the ParkManagerService to the ParkServiceStatusGUI if the OUTDOOR-area has not been vacated within an interval of time DTFREE;</li>

Our interaction with the customer has made it clear what he means for:
<li><kn>thermometer</kn>: an simulate device capable of detects the temperature in the parking-area. It sends the information taken via the network the network as event emitter;</li>
<li><kn>fan</kn>: an device capable to lower the temperature of the parking. It could be in on/off state and it is possible switch the state with dispatch messages via the network;</li>

<h4>The Outsonar</h4>
		<table>
			<tbody>
				<tr>
					<td>
						<kn>outsonar</kn>: an simulate or (optionally) a real device capable of detecting the presence of a car. It is in the OUTDOOR-area and sends the information taken via the network as event emitter.
						<br>
						 In this case it is a real device and the costumer gives us the seguent software: <a href="https://raw.githubusercontent.com/anatali/issLab2021/main/it.unibo.rasp2021/resources/rasp/sonar/SonarAlone.c" target="web"> SonarAlone.c</a> and  <a href="https://www.acmesystems.it/HC-SR04" target="web">HC-SR04 ultrasonic sensor.</a> <br>
						 The <a href="https://www.acmesystems.it/HC-SR04" target="web">HC-SR04 ultrasonic sensor.</a> could be activated 'on demand'
						 or could be embedded in a component that provides a <k>'hot-source' of data</k>, i.e. an active component that emits information in a continuous way.
					
					</td>
				</tr>
		</tbody>
</table>


		

	<div class="remark"> To destroy the abstraction gap is possible to use QACTOR which is a modelling language and defines a work model of the system based on actors behavior.
	</div>


<h2> Problem analysis</h2>

	The list of requirements for this sprint is:
	<ul>
		<li>the <tt>OUTsonar</tt> detects the presence of a car in the OUTDOOR-area(3); </li>
		<li>the <tt>weigthsensor</tt> detects and measures the weight of the car in the INDOOR-area(3); </li>
	</ul>
	To handle the information sent by the OUTsonar, the application must be able to:
		<ul>
			<li>communicate with the <tt>l'OUTSonar;</tt></li>
			<li>manage the information received from <tt>OUTSonar</tt> relating to the status of the <tt>OUTDOOR-area</tt>;</li>
			<li>send an alarm after a DTFREE time if the <tt>OUTDOOR-area</tt> is not yet vacated.</li>
		</ul>
	To handle the information sent by the <tt>weightsensor</tt>, the application must be able to:
		<ul>
			<li>communicate with the <tt>weightsensor</tt>;</li>
			<li>manage the information received from <tt>weightsensor</tt> relating to the status of the <tt>INDOOR-area</tt>.</li>

	</ul>
	To handle the information sent by the <tt>thermometer</tt> and <tt>fan</tt>, the application must be able to:
		<li>communicate with the <tt>thermometer</tt>;</li>
		<li>communicate with the <tt>fan</tt>;</li>
		<li>manage the information received from <tt>thermometer</tt> relating to the temperature of the <tt>parking-area</tt>;</li>
		<li>send the stop / start commands to the <tt>fan</tt>.</li>
		</ul>

	<h3>Components</h3>

		<h4 id="weightsensor">Weightsensor</h4>
			
			<table>
					<tbody>
						<tr>
							<td>
										
							The Weightsensor is modelled as a mock QActor and it is an events emitter which are sent when the INDOORAREA is vacated. It should be able to send the information about the weight too. <br>
							To simulate this behavior the parkservicegui informs it that the client enters the car in the INDOORAREA thus it could start to send events until the transport-trolley takes the car and frees up the INDOORAREA. 
		
							</td>
							<td style="width: 55%">
					
					 <center><img src="./img/weightsensorState.png" alt="weightsensorState" width="100%" ></center> 
							</td>
						</tr>
					</tbody>
				</table> 
<h4>The OutSonar</h4>
 <center><table style="width:95%">
<tbody>	
<tr>
<td style="width:50%" ><h3>Sonar as event emitter</h3>

	For the real world, the  model of the <ks>sonar</ks> could be defined as a qak
<a href="https://raw.githubusercontent.com/anatali/issLab2021/main/it.unibo.rasp2021/codedqak/sonarHCSR04Support2021.kt" target="code">sonarHCSR04Support2021.kt</a>
that embeds <a href="https://raw.githubusercontent.com/anatali/issLab2021/main/it.unibo.rasp2021/resources/rasp/sonar/SonarAlone.c" target="code">SonarAlone.c</a> ,
<br/> <br/> 
<center><img src="./img/sonarSupport2021.PNG" alt="sonarSupport2021" width="50%" ></center>
<br/> 
This component is written in Kotlin and emits events. <br/><br/>
As an extensionons of the qak basic class
<a href="https://raw.githubusercontent.com/anatali/issLab2021/main/it.unibo.qakactor/src/main/kotlin/ActorBasic.kt" target="code">ActorBasic.kt</a>.

<div class="remark">
When using a real sonar, several 'bad' things can happen, including the possibility to generate spurios values.
</div>
			</kn>		
			<table>
					<tbody>

		<h3 id="outsonar">Outsonar</h3>

						<tr>
							<td>
								In our analysis, the <ks>sonar</ks> is an autonmous active component that does not 'known' any other component.
								Thus the Outsonar is modelled as a mock QActor and it is an events emitter when the OUTDOORAREA is vacated.<br> 
								To simulate this behavior the transporttrolley inform it that there is a car in the OUTDOORAREA thus it could start to send events until the client takes the car and frees up the OUTDOORAREA. 
		
	
							</td>
							<td style="width: 55%">
					
					 <center><img src="./img/outsonarState.png" alt="outsonarState" width="70%" ></center> 
							</td>
						</tr>
					</tbody>
				</table> 
		

<!-- 
A simulator that emits the <ks>sonar:distance(D)</ks> event is defined in
<a href="../../it.unibo.rasp2021/codedqak/sonarsimulator.kt" target="code">sonarsimulator.kt</a>.
-->
 </td>
</tr>
  </tbody>
</table></center>

		<h4 >Outmanager</h4><table>
					<tbody>
						<tr>
							<td>
							The Outmanager was modelled as QActor and its aim is to send an alarm (event) when the OUTDOORAREA is still vacated over a DTFREE time. 
							It is a part of ParkManagerService and it is specialized to manage the outsonar informations. 
							The reason why it is necessary modelled this actor is the implementation of timer and, thus, guarantee the fulfillment of other actions by other components while the timer is going.  
	
							</td>
							<td style="width: 55%">
					
					 <center><img src="./img/outmanagerState.png" alt="outmanagerState" width="70%" ></center> 
							</td>
						</tr>
					</tbody>
				</table> 

				<h4 id="fan">Fan</h4>
			<table>
					<tbody>
						<tr>
							<td>
								In this case the component will be activated by the ParkManagerService or the parking-manager.
								<br>The costumer didn't given any software or device about the component but the costumer asked us to use mock-actor or mock-objects to simulate the behavior.
								<br> The fan will be modeled as a QActor.
					</td>
							</td>
							<td style="width: 55%">
					
								<center><img src="./img/FanState.drawio.png" alt="FanState" width="400" ></center> 
							</td>
						</tr>
					</tbody>
				</table> 
				
		<h4 id="thermometer">Thermometer</h4>
			<br>
			<table>
					<tbody>
						<tr>
							<td>
								In our analysis, this element is an autonmous active component that does not 'known' any other component. Thus, it is actually modelled as an emitter of events.
								The thermometer will be modeled like QActors.</li> 
							</td>
							<td style="width: 55%">
								<center><img src="./img/ThermoterState.drawio.png" alt="ThermoterState" width="40%" ></center> 
							</td>
						</tr>
					</tbody>
			</table> 
			
			
	<h4>The ParkManagerService</h4>
	The ParkManagerService was modelled as in the <a href="https://htmlpreview.github.io/?https://github.com/noemival/ParkManagerService_2021/blob/main/it.unibo.parkManagerService/it.unibo.sprint2/userdocs/sprint2.html"target="web">sprint2.html</a>, except for handleling messages which are sent by the weightsensor.
	
	<h4>The ParkingManager</h4>
 			<table>
					<tbody>
						<tr>
							<td>
								ParkingManager application server that interacts via network with the the thermometer and fan.
							</td>
							<td style="width: 55%">
								<center><img src="./img/ParkmanagerState.drawio.png" alt="ParkManagerServiceState" width="400" ></center> 
							</td>
						</tr>
					</tbody>
			</table> 

	


	<h3>Components comunication</h3>
	<table style="width:98%">	
		<td style="width:50%" >
				<center><img src="./img/comunication_sprint3.png" alt="comunication" width="50%" ></center> 
		</td>
	</table>
	<br></br>

		<table style="width:98%">	
				<tr>
						<k>Weightsensor </k>
						
					<td style="width:50%" >
						
						<br> The weightsensor as an events emitter
					</td>
					<td>
						<pre>
Event weightsensor : weightsensor (W)

Context ctxparkingarea ip [host="localhost" port=8021]

QActor weightsensor context ctxparkingarea{
	...
		emit weightsensor : weightsensor ($WEIGHT)
	...

}
					    </pre>
					</td>
					</tr>
				</tbody>
			</table>
			<br>		<table style="width:98%">	
				<tr>
						<k>Outsonar </k>
						
					<td style="width:50%" >
						
						<br> The outsonar as an events emitter
					</td>
					<td>
						<pre>
Event outsonar : outsonar (O)

Context ctxparkingarea ip [host="localhost" port=8021]

QActor outsonar context ctxparkingarea{
	...
		emit outsonar : outsonar(O)
	...

}
					    </pre>
					</td>
					</tr>
				</tbody>
			</table>
			<br>			
			
		<table style="width:98%">	
				<tr>
						<k>Outmanager/ParkManagerService </k>
					
					<td style="width:50%" >
						
						<br> The Outmanager will send dispatches to the
						ParkManagerService to inform it if the OUTDOORAREA is vacated or not. When it is over the DTFREE the OutManager will send to the ParkManagerService an alarm which is an event.
					</td>
					<td>
						<pre>
Dispatch outfree : outfree(free)

Context ctxparkingarea ip [host="localhost" port=8021]

QActor outmanager context ctxparkingarea{
...
	State work{
	...
		forward parkmanagerservice -m outfree : outfree (occ)
	...		
	} 	
	}
	State free {
		forward parkmanagerservice -m outfree : outfree (free)
	}
}
	

					    </pre>
					</td>
					</tr>
				</tbody>
			</table>
			<br>				
			<table>
				
<table style="width:100%">
			<tbody>	
				<tr>
						<k>Thermometer</k>
						
					<td style="width:50%" >
						
						<br> The thermometer as an emitter of event.
					</td>
					<td>
						<pre>
Event temperature : temperature (T)

Context ctxparkingarea ip [host="localhost" port=8021]

QActor thermometer context ctxparkingarea{
	...
		emit temperature : temperature ($VALUE)
	...

}


					    </pre>
					</td>
					</tr>
				</tbody>
			</table>

		<table >
			<tbody>	
				<tr>
						<k>ParkingManager/Fan</k>
						
					<td style="width:50%" >
						<br> The ParkingManager and the parking-manager will communicate with the fan with dispatches because it isn't necessary a response to continue the execution. 
						Furthermore, the ParkingManager will not send all the values generated by the thermometer, but only those that involve a change in the state of the fan, so as to reduce the number of messages exchanged.
					</td>
					<td>
						<pre>
Dispatch fanstart: fanstart(V)
Dispatch fanstop : fanstop(V)
						
Context ctxparkingarea ip [host="localhost" port=8021]

QActor parkmanagerservice context ctxparkingarea {
	...
		forward fan -m fanstart: fanstart(on) 
	...
		forward fan -m fanstop: fanstop(off)

}
					    </pre>
					</td>
					</tr>
				</tbody>
			</table>

				

<br>
<div class="remark">
The executable model is the following file: <a href="https://raw.githubusercontent.com/noemival/ParkManagerService_2021/main/it.unibo.parkManagerService/it.unibo.sprint3/src/sprint3.qakt"target="web">sprint3.qak</a>						
</div>	

<h3>SPRINT REVIEW</h3>
	
	The analysis was produced some aspects that will be considerend in the next SPRINT: 
	<li>the ParkManagerService will send an alarm to the ParkServiceStatusGui when the OUTDOORAREA is still vacated over a DTFREE time.</li>

<h2>Testplan</h2>

	<k>Testplan </k>: we should simulate and check if the parkManagerService recive the alarm from the outmanager when the OUTDOORAREA is still vacated over a DTFREE time.
<br><br> The code is the following file:  <a href="https://raw.githubusercontent.com/noemival/ParkManagerService_2021/main/it.unibo.parkManagerService/it.unibo.sprint3/test/it/unibo/sprint_3/TestPlan.kt"target="web">TestPlan.kt</a></p>
	<br>
	To realize an authomatized test we will use JUNIT.
	
<h2>Project</h2> 

<h4>WebApplicationPms</h4>

	The WebApplicationPms will be a system of actors and other components that implements the required automation functions. It is a distributed service accessible via HTTP:
	<pre>http://localhost:8081</pre> 
	The service recives the information of some sensors via MQTT. <br>

	The WebApplication is in the following folder: <a href="https://github.com/noemival/ParkManagerService_2021/tree/main/it.unibo.parkManagerService/it.unibo.sprint2/it.unibo.WebApplicationPms"target="web">it.unibo.WebApplicationPms</a>
		
<br><br>

<h6>Sensor Controllers</h6>

	These controller represent the WebApplication controller that are responsible for processing the information sending by the request and interact with our core application. 
		<h3>ControllerSonar</h3>
	<table>
				<tbody>	
						<tr>
							<td>
								<li>The ControllerSonar is a controller used to manage the information sending by the real sonar device to our application. </li>
								<li>The sonardata source will be
 								<a href="https://raw.githubusercontent.com/anatali/issLab2021/main/it.unibo.rasp2021/codedqak/sonarHCSR04Support2021.kt" target="code">sonarHCSR04Support2021.kt</a>, the ControllerSensor will recive the data and will forward the informations to our  <a href="#outsonar">outsonar</a> that represent 
								 our domain-core in the project phase and resource. </li>
								 <li>The ControllerSonar receives the sonardata using MQTT because this protocol is able to realize the event based comunication thanks to the characteristic of decoupling sender and receiver. </li>
<pre>
<k>mqttBroker</k> "broker.hivemq.com" : 1883 <ks>eventTopic "sonar/data"</ks>
</pre>
</li>
</ol>

</li> 
	
							</td>
							<td style="width: 55%">
								<pre>
@Controller
class ControllerSonar{						
	@MqttSubscribe(topic = "sonar/data" , qos = AT_LEAST_ONCE)
	fun subscribe ( payload:String) {
		var message = ApplMessage(payload)
		appConnection.sendForward("sonar", message.msgContent(),"outsonar")
		println( "distance = "+message.msgContent())
		}
}				</pre>
							</td>
						</tr>
					</tbody>
				</table> 
<h3>ControllerWeighSensor</h3>
	<table>
				<tbody>	
						<tr>
							<td>
								<li>The ControllerSensor is a controller used to manage the information sending by the WeightSensorGui which simulate the car detection in the INDOORAREA. </li>
								<li>The ControllerSensor will recive the data and will forward the informations to our  <a href="#weightsensor">weightsensor</a> that represent our domain-core in the project phase and resource. </li>
								 <li>The ControllerSensor receives the weighsensor-data using MQTT because this protocol is able to realize the event based comunication thanks to the characteristic of decoupling sender and receiver. </li>
								 
<pre>
<k>mqttBroker</k> "broker.hivemq.com" : 1883 <ks>eventTopic "weightsensor/data"</ks>
</pre>
</li>
</ol>

</li> 
	
							</td>
							<td style="width: 55%">
								<pre>
@Controller
class ControllerWeighSensor {					
	@MqttSubscribe(topic = "weightsensor/data" , qos = AT_LEAST_ONCE)
	fun subscribe ( payload:String) {
		println( "weight = "+payload )
		appConnection.sendForward("weightsensor","weight(${payload})", "weightsensor")
		stateButtonCarEnter = "Enabled"
		}
}	
				</pre>
							</td>
						</tr>
					</tbody>
				</table> 
					<h3>ControllerThermometer</h3>
	<table>
				<tbody>	
						<tr>
							<td>
								<li>The ControllerThermometer is a controller used to manage the information sending by the <a href="https://raw.githubusercontent.com/noemival/ParkManagerService_2021/main/it.unibo.parkManagerService/it.unibo.sprint3/src/mockTherm.qak"target="web">moktherm.qak</a> which simulate the variation of the temperature in the parkingarea. </li>
								<li>The ControllerThermometer will recive the data and will forward the informations to our  <a href="#thermometer">thermometer</a> that represent our domain-core in the project phase and resource. </li>
								 <li>The ControllerThermometer receives the thermometer-data using MQTT because this protocol is able to realize the event based comunication thanks to the characteristic of decoupling sender and receiver. </li>

<pre>
<k>mqttBroker</k> "broker.hivemq.com" : 1883 <ks>eventTopic "thermometer/data"</ks>
</pre>
</li>
</ol>

</li> 
	
							</td>
							<td style="width: 55%">
								<pre>

@Controller
class ControllerThermometer{					
	@MqttSubscribe(topic = "thermometer/data" , qos = AT_MOST_ONCE)
	fun subscribe ( payload:String) {
		var message = ApplMessage(payload)
		println( "temperature = "+message.msgContent() )
		appConnection.sendForward(message.msgId(), message.msgContent(),"thermometer")
		}
}
				</pre>
							</td>
						</tr>
					</tbody>
				</table> 

				<h3>ControllerFan</h3>
	<table>
				<tbody>	
						<tr>
							<td>
								<li>The ControllerFan is a controller used to manage the information sending by our application. </li>
								<li>The ControllerFan will recive the data by our <a href="#fan">fan</a>, that represent our domain-core in the project phase and resource, using COAP method because it should observe the fan resource behaviour. </li>
								 <li>The ControllerFan will send fan-data, recived by COAP, using TCP because this protocol is able to realize an asynchronous communication to send the commands to the FanGUI that is a passive component.</li>

</li>
</ol>

</li> 
	
							</td>
							<td style="width: 55%">
								<pre>

@Controller
class FanController {				
	var coap    = CoapSupport("coap://localhost:8021", "ctxparkingarea/fan")
	init{
		sysUtil.colorPrint(" | INIT", Color.GREEN)
		coap.observeResource( FanCoapHandler(this) )
	}

	@ResponseBody
	@PostMapping("/fandata")
	fun  handleSonarValue(@RequestParam(name="info", required=false, defaultValue="0")v : String){
		coap.updateResourceWithValue(v)
	}
}
				</pre>
							</td>
						</tr>
					</tbody>
				</table> 
				<br><br><br><br><br><br><br><br><br>
<h3>Logical Architecture</h3>
<table>	
		<td style="width:50%" >
				<center><img src="img/architettura_logica3_project.png" alt="mappa" width="45%" ></center> 
		</td>
	</table>
<h2>Testing</h2>
<p><ks>Testing</ks>: we should simulate and check after a same notify in if two clients with the same slotnum will be processed in different ways. One could press carenter, only after the weightsensor will decect its presence, the other one couldn't press carenter. </p>

<p>The code is present in the following file: <a href="https://raw.githubusercontent.com/noemival/ParkManagerService_2021/main/it.unibo.parkManagerService/it.unibo.sprint3/testing/Testing.kt"target="web">Testing.kt</a> </p>

<p><ks>Testing 2</ks>: we should simulate and check if the fan turn on/off when the temperature is higher/lowre than TMAX. </p>

<p>The code is present in the following file: <a href="https://raw.githubusercontent.com/noemival/ParkManagerService_2021/main/it.unibo.parkManagerService/it.unibo.sprint3/testing/Testing2.kt"target="web">Testing.kt</a> </p>

<p><ks>Testing 2</ks>: we should simulate and check if the weighsensor resource will update its state after publishing value with MQTT. </p>

<p>The code is present in the following file: <a href="https://raw.githubusercontent.com/noemival/ParkManagerService_2021/main/it.unibo.parkManagerService/it.unibo.sprint3/testing/Testing3.kt"target="web">Testing.kt</a> </p>

To realize an authomatized test we will use JUNIT.

<h2>Deployment</h2>
	
The project is located in the repository: <a href="https://github.com/noemival/ParkManagerService_2021/tree/main/it.unibo.parkManagerService"target="web">https://github.com/noemival/ParkManagerService_2021/tree/main/it.unibo.parkManagerService</a></p>
Before activate the sensor launch:
<ol>
	<li><a href="https://raw.githubusercontent.com/noemival/ParkManagerService_2021/main/it.unibo.parkManagerService/it.unibo.sprint3/src/sprint3_project.qak"target="web">sprint3_project.qak</a> situated in the directory <a href="https://github.com/noemival/ParkManagerService_2021/tree/main/it.unibo.parkManagerService/it.unibo.sprint3"target="web">it.unibo.sprint3</a> </li>
	<li><a href="https://raw.githubusercontent.com/noemival/ParkManagerService_2021/main/it.unibo.parkManagerService/it.unibo.sprint3/it.unibo.WebApplicationPms/src/main/kotlin/it/unibo/webApplicationPms/CarkApplication.kt"target="web">CarkApplication.kt</a> situated in the directory <a href="https://github.com/noemival/ParkManagerService_2021/tree/main/it.unibo.parkManagerService/it.unibo.sprint3/it.unibo.WebApplicationPms/src/main/kotlin/it/unibo/webApplicationPms"target="web">it.unibo.webApplicationPms</a></li>
</ol>

<h3>OutSonar Configuration <em>UseMQTT</em></h3>
<table style="width:100%" border="1">

<tr>
<td style="width:50%">
<center><img src="./img/sonarpipeDistrib.png" alt="sonarpipeDistribonRasp" width="90%" ></center>
 

Execute <a href="https://github.com/noemival/ParkManagerService_2021/tree/main/it.unibo.parkManagerService/it.unibo.sonarRaspberry-1.0/bin" target="web">it.unibo.sonarRaspberry</a> on RaspberryPi
</td>
<td>
<pre>
<m>
%====================================================================================
% sonaronrasp description   (file <ks>sonaronrasp.pl</ks> )
%====================================================================================
<k>mqttBroker("broker.hivemq.com", "1883", "sonar/data").</k>
context(ctxsonaronrasp, "localhost",  "TCP", "8068").
  qactor( sonarsimulator, ctxsonaronrasp, "sonarSimulator").
  qactor( sonardatasource, ctxsonaronrasp, "sonarHCSR04Support2021").
  qactor( datacleaner, ctxsonaronrasp, "dataCleaner").
  qactor( sonar, ctxsonaronrasp, "it.unibo.sonar.Sonar").
msglogging.</m></pre>
</td>
</tr>
 </tbody>
</table>
<h3>MockThermometer Configuration <em>UseMQTT</em></h3>
<table style="width:100%" border="1">

<tr>
<td style="width:50%">
 
Launch <a href="https://raw.githubusercontent.com/noemival/ParkManagerService_2021/main/it.unibo.parkManagerService/it.unibo.sprint3/src/mockTherm.qak"target="web">moktherm.qak</a>  on Pc.
 
</td>
<td>
<pre>
<m>
%====================================================================================
% mockterm description   
%====================================================================================
mqttBroker("broker.hivemq.com", "1883", "thermometer/data").
context(ctxthermometer, "localhost",  "TCP", "8023").
 qactor( mockthermometer, ctxthermometer, "it.unibo.mockthermometer.Mockthermometer")
 </m></pre>
</td>
</tr>
 </tbody>
</table>
<h3>WeightSensorGui <em>UseMQTT</em></h3>
<table style="width:100%" border="1">
Launch the   <a href="https://raw.githubusercontent.com/noemival/ParkManagerService_2021//main/it.unibo.parkManagerService/it.unibo.sprint3/it.unibo.WebApplicationPms/src/main/kotlin/it/unibo/webApplicationPms/sensorMockGui/WeightSensorGui.kt"target="web">WeightSensorGui.kt</a> situated in the directory <a href="https://github.com/noemival/ParkManagerService_2021/tree/main/it.unibo.parkManagerService/it.unibo.sprint3/it.unibo.WebApplicationPms/src/main/kotlin/it/unibo/webApplicationPms/sensorMockGui"target="web">it.unibo.sensorMockGui</a> on Pc
</table>

<h3>FanGui<em>ResourceAware</em></h3>
<table style="width:100%" border="1">
Launch the Launch the   <a href="https://raw.githubusercontent.com/noemival/ParkManagerService_2021//main/it.unibo.parkManagerService/it.unibo.sprint3/it.unibo.WebApplicationPms/src/main/kotlin/it/unibo/webApplicationPms/sensorMockGui/Fangui.kt" target="web">Fangui.kt </a> situated in the directory <a href="https://github.com/noemival/ParkManagerService_2021/tree/main/it.unibo.parkManagerService/it.unibo.sprint3/it.unibo.WebApplicationPms/src/main/kotlin/it/unibo/webApplicationPms/sensorMockGui"target="web">it.unibo.sensorMockGui</a> on Pc
</table>


 
<!-- USEFUL
<table style="width:100%" border="1">
<tr>
<td style="width:50%">
</td>
<td></td>
</tr>
</table>
-->
	      	
<br/><br/> 	
</div>  

<div style="background-color:rgba(86, 56, 253, 0.9); width:60%;text-align:left;color:white">
By studentName email: antonio.iacobelli@studio.unibo.it  
<img src="./img/antonioIacobelli.jpg" alt="mbot" width="15%" height="15%">
</div> 
<br>
<div style="background-color:rgba(86, 56, 253, 0.9); width:60%;text-align:left;color:white">
By studentName email: noemi.valentini5@studio.unibo.it  
<img src="./img/noemiValentini.jpg" alt="mbot" width="15%" height="15%">
</div> 
</body>
</html>
