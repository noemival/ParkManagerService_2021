<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <!--
<link rel="stylesheet" type="text/css" href="../css/issStyle1.css">
<script type="text/javascript" src="../css/issStyle.js"></script>
-->
<style type="text/css">
body
{
    margin-left:  30px;
    margin-right: 30px;
};

P
{
    font-family: Tahoma;
    font-size: 10pt;
};

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
	font-size: 93%;
}

a:hover {
    background-color: #cccccc;
}


hr {
    clear: both;
    height: 1px;
    color: #242424;
    background-color: transparent;
}

h1, h2, h3 {
    color: #242424;
    clear: left;
    font: 100% Tahoma, Helvetica, Arial, sans-serif;
    margin-bottom: 0.5em;
    padding-top: 0.5em;
	border-radius: 10px;
	padding: 5px;
}

top {
	width: 100%;
}


#i {
    color: #ff1010;
}
tt{
	font-family: "Arial";
    font-size: 90%;
	color: #006600;
}
em{
	font-family: "Arial";
    font-size: 80%;
	font-weight: bold;
	border-style:solid;
	border-color: #abe876;
    color: #1632cc;
}
bc{
	font-family: "Arial";
	font-size: 90%;
	font-weight: bold;
    color: #990000;
	background-color: #fcf8c7;
}
ks{
	font-family: "Arial";
	font-weight: bold;
    color: #0000CD	;
	font-size: 90%;
}
kc{
	font-family: "Arial";
	font-weight: bold;
    color: #008000	;
	font-size: 90%;
}
pre{
	font-family: "Consolas";
	font-size: 85%;
	background-color: #f5f5f5;
	border: 1.5px solid silver;
	padding: 5px;
}
m{
	font-family: "Helvetica";
	line-height: 100%;
 	font-size: 75%;
}
div.body{
	 
    font-size: 18px;
}
k{
	font-family: "Arial";
    color: #990000;
	font-weight: bold;
	font-size: 90%;
}
kn{
	font-family: "Arial";
    color: #0000CD	;
	font-size: 90%;
}
h1 {
    font-size: 150%;
    background-color: #b2c0ff;
	padding: 10px;
}

h2 {
    background-color: #9ed8ff;
    font-size: 130%;
}

h3 {
	background-color: #e6ccff;
    font-size: 100%;
}
h4 {
    background-color: #ccffcc;
    font-size: 100%;
	width: 95%;
	border-radius: 5px;
	padding: 2px;
}
h5 {
    background-color: #d5ffb0;
    font-size: 100%;

}
h6 {
    background-color: #d5fff0;
    font-size: 100%;

}
div.req{
	background-color: #d9ffb3;
    font-size: 18px;
	width: 700px;
    border: 3px solid green;
    padding: 15px;
    margin: 10px;
}
div.remark{
	background-color: #E3F2FD;
    border: 1.5px solid #d5f2ed;
    padding: 15px;
    margin: 10px;
	border-radius: 25px;
}
table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
}

ol, ul, li {
  margin: 0;
  margin-left: 10px;
  padding: 0;
  padding-bottom: 5px;
}

table, th, td {
	border: 1px solid black;
}

img {
	border: 1.5px solid #d5f2ed

}

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
}

div.wrapdesc{
	width: 90%;
	margin: auto;
}

div.imagedesc{
	width: 85%;
	margin: auto;
}
</style>
    
<head>
   
<title>Sprint 2</title></head>
    
<body>
<div id="top">
<h1>Workplan Automated Car-Parking- Sprint 2 <font size="5"></font> </h1>
</div>  

<h2>Requirements</h2>

<div class="remark">
The requirements given by the costumers  <a href="https://github.com/anatali/issLab2021/blob/main/it.unibo.issLabStart/userDocs/TFBO21ISS.pdf" target="web">Automated Car-Parking</a> considered in the following SPRINT are:</li>
</div> 
<li>A software system, named <em>ParkManagerService</em>, that implements the required automation functions.</li>

<h3>User stories</h3>
As a <bc>client - parking phase</bc> :
<ul>
<li>I intend to use a <em>ParkServiceGUI</em> provided by the <tt>ParkManagerService</tt>  to notify my interest in <i>entering</i> 
my auto in the <tt>parking-area</tt> and to receive as answer the number <em>SLOTNUM</em> of a  free parking-slot  (<tt>1&lt;=SLOTNUM&lt;=6</tt>). 
<tt>SLOTNUM<k>==0</k></tt> means that no free slot is available.</em>

</li>
<li>If <tt>SLOTNUM <k>>0</k></tt>, I move my car in front to the <tt>INDOOR</tt>, get out of the car and afterwards press a <em>CARENTER</em> button on the
<em>ParkServiceGUI</em>. Afterwards, the <tt>transport trolley</tt> takes over my car and moves it from the <tt>INDOOR</tt> 
to the selected <tt>parking-slot</tt>.
The <tt>ParkServiceGUI</tt> will show to me a receipt that includes a (unique) <em>TOKENID</em>, 
to be used in the <i>car pick up</i> phase.</li>
</ul>

As a <bc>client - car pick up phase</bc> :
<ul>
<li>I intend to use the <tt>ParkServiceGUI</tt> to submit the request to pick up my car, by sending the <tt>TOKENID</tt> previously received. </li>  
<li>Afterwards, the <tt>transport trolley</tt>  takes over my car and moves it from its <tt>parking-slot</tt> to the <tt>OUTDOOR-area</tt>.</li>
<li>I move the car, so to free the <tt>OUTDOOR-area</tt>.
</li>
 </ul>

 <ul>
 
<li><hr/>
<em>acceptIN</em>: accept the request of a client to park the car if there is at least one <tt>parking-slot</tt> available,
select a free slot identified with a unique <tt>SLOTNUM</tt>.<br/>
A request of this type can be elaborated only when the <k><tt>INDOOR-area</tt> is free</k>, 
and  the <tt>transport trolley</tt> is at <tt>home</tt> or working (<k>not stopped</k> by the manager). 
If the <tt>INDOOR-area</tt> is already engaged by a car, the request is not immediately processed 
(the client could simply wait or could - optionally - receive a proper notice). 
<br/>
  <li><em>informIN</em>: inform the client about the value of the <tt>SLOTNUM</tt>.</li> 
If  <k>SLOTNUM>0</k>:
  <ol>
   <li><em>moveToIn</em>: move the <tt>transport trolley</tt> from its current localtion to the <tt>INDOOR</tt> ;</li>
  <li><em>receipt</em>: send to the client a receipt including the value of the <tt>TOKENID</tt> ;</li> 
  <li><em>moveToSlotIn</em>: move the <tt>transport trolley</tt> from the <tt>INDOOR</tt> to the selected <tt>parking-slot</tt>;</li>
  <!-- <li>accept another request (<tt>acceptIN</tt> or <tt>acceptOUT</tt>). -->
  <li><em>backToHome</em>: if no other request is present,  move the <tt>transport trolley</tt> to its <tt>home</tt> location,
  else <em>acceptIN</em> or <em>acceptOUT</em>.</li> 
  </ol>
 </li>
If <k>SLOTNUM==0</k>: 
	<ul>
	<li><em>moveToHome</em>: if not already at home, move the <tt>transport trolley</tt> to its <tt>home</tt> location.</li> 
	</ul>
</li>


<li><hr/>
<em>acceptOUT</em>: accept the request of a client to get out the car with <tt>TOKENID</tt>.
A request of this type can be elaborated only when the <k><tt>OUTDOOR-area</tt> is free</k> 
and  the <tt>transport trolley</tt> is at <tt>home</tt> or working (<k>not stopped</k> by the manager).
If the <tt>OUTDOOR-area</tt> is still engaged by a car, the request is not immediately processed 
(the client could simply wait or could - optionally - receive a proper notice).

	<ol>
	<li><em>findSlot</em>: deduce the number of the parking slot (<em>CARSLOTNUM</em>) from the <tt>TOKENID</tt>;</li>
	<li><em>moveToSlotOut</em>: move the <tt>transport trolley</tt> from its current localtion to the <tt>CARSLOTNUM/parking-slot</tt> ;</li>
	<li><em>moveToOut</em>: move the <tt>transport trolley</tt> to the <tt>OUTDOOR</tt> ;</li>
	<li><em>moveToHome</em>: if no other request is present  move the <tt>transport trolley</tt> to its <tt>home</tt> location; <br/>
	else <em>acceptIN</em> or <em>acceptOUT</em></li> 

	</ol> 
</li>
The following sprint will focus to <kn>realize the interection between the parkManagerService and client</kn>.


<h2>Requirement analysis</h2>

Our interaction with the customer has made it clear what he means for:
<li><kn>SLOTNUM</kn>: unique identifier of a parking-slot;</li>
<li><kn>CARSLOTNUM</kn>: unique identifier of a parking-slot retrieved by TOKENID;</li>
<li><kn>TOKENID </kn>: unique string assigned to a client when his entrance request was accepted; </li>
<li><kn> client</kn>: an entity who send messages to the ParkerServiceManager via the network;
<li><kn>CARENTER</kn>: a ParkServiceGui graphic element that allows an user to notify the intention to let the car in;
	<li><kn> request </kn>: a message which was sent by the client to the ParkerServiceManager in order to receive a service. The client will wait a reply when the service was complete.</li>

<h4>ParkServiceGUI </h4>
	An user interface that allows a client to with our system. The costumer requires that it will be portable, indipendent from hardware components and from the operative system of the user device so the choise will be to realize a Web GUI.


<h2>Problem analysis</h2>
<div>
	The list of requirements for this sprint is:
	<ul>
		<li>the <tt>client</tt> request to enter in the parking-area using the ParkServiceGui (2);</li>
		<li>the <tt>client</tt> request to exit from the parking-area using the ParkServiceGui (2);</li>
	</ul>
	To carry out the operations requested by the client (acceptIN, informIN, receipt, acceptOUT, findSlot) it is necessary that the application, in addition to being able to perform the basic transport-trolley moves, is capable of:
	<ul>	
		<li>handle the <tt>TOKENID</tt>, <tt>SLOTNUM</tt>, <tt>CARSLOTNUM</tt>;
		<li>the client send/receive information or command to/from client; </li>
		<li>check the availability of resources, <tt>INDOOR-area</tt>, <tt>OUTDOOR-area</tt>, <tt>parking-slot</tt>, verification of the presence of client requests;</li>
		<li>tell to the robot how it should behave given the customer's requests; </li> 
		<li>realize the <tt>ParkServiceGui</tt>.</li>
	</ul>
</div>
	
	<div class="remark"> To destroy the abstraction gap is possible to use QACTOR which is a modelling language and defines a work model of the system based on actors behavior.
	</div>
	
	<h3>Components</h3>
		<h4>ParkServiceGui</h4>
			
			<table>
					<tbody>
						<tr>
							<td>
								The choise will be to realize the Web-application GUI in the following way:
								<ul>
									<li>they could be  HTML pages implemented to recive information, INPUT sections (e.g. CARENTER) and to send information, OUTPUT sections (e.g. TOKENID).</li> 
								</ul>
								The techology should be SpringBoot to reduce development time.
								Right now we just confine its behavior to a mock-qactor. Its complete realization will be done in the project phase.
							</td>
							<td style="width: 55%">
					
					 <center><img src="./img/ParkingServiceGui.drawio.png" alt="ParkingServiceGui" width="100%" ></center> 
							</td>
						</tr>
					</tbody>
				</table> 

	

		<h4>The ParkManagerService</h4>
		
			</kn> <br>
		
			<table>
					<tbody>
						<tr>
							<td>
							The ParkManagerService, in this sprint, will be a part of the WebApplicationPms. The ParkManagerService will be modelled as a QActor to simulate one part of requirements:
								<ul>
							<li>It should manage the requests from the clients, excecute them and elaborate the replies.</li> 

			<li>The ParkManagerService is modelled to manage the requests of more clients. For example if two clients notify the interest to enter, to recognise the correct client who pressed CARENTER, the client should send the SLOTNUM previously sending by the ParkManagerService. 
			<br>The Weightsensor and Outsonar are implemented to simulate the behavior and manage more clients.</li>

			<li>The commands MovetoSlotIn and MoveToSlotOut can be group in one command MoveToSlot+SLOTNUM where the transport-trolley should go because the transport-trolley hasn't any interest to know if is an In or Out request. </li>

			<li>The management of the SLOTNUM, CARSLOTNUM and TOKENID is implemented in the file kotlin <a href="https://raw.githubusercontent.com/noemival/ParkManagerService_2021//main/it.unibo.parkManagerService/it.unibo.sprint2/src/utility/Slotnum.kt"target="web">Slotnum.kt</a>. </li>
			<li>The TOKENID could be modeled with the SLOTNUM+TIMESTAMP to be unique and to easly retrieve the CARSLOTNUM.</li>
	</ul>
							</td>
							<td style="width: 55%">
					
					 <center><img src="./img/ParkManagerServiceState.drawio.png" alt="ParkManagerServiceState" width="70%" ></center> 
							</td>
						</tr>
					</tbody>
				</table> 
		
		<h4>The transport-trolley</h4>
			The transport-trolley was modelled like in the <a href="https://htmlpreview.github.io/?https://github.com/noemival/ParkManagerService_2021/blob/main/it.unibo.parkManagerService/it.unibo.sprint1/userdocs/sprint1.html" target="web"> sprint1.html</a> to excecute the ParkManagerService tasks. 
		<h4>The basicrobot</h4>
			The basicRobot was modelled like in the <a href="https://htmlpreview.github.io/?https://github.com/noemival/ParkManagerService_2021/blob/main/it.unibo.parkManagerService/it.unibo.sprint1/userdocs/sprint1.html" target="web"> sprint1.html</a>. It will use to communicate between the DDR robot and the transport-trolley.
		<h4>Database</h4>
			
	<h3>Components comunication</h3>
	<br>
	<table style="width:98%">	
		<td style="width:50%" >
				<center><img src="./img/architettura_logica.png" alt="architettura_logica_iniziale" width="60%" ></center> 
		</td>
	</table>
	
	<br><br>

		<table >
			<tbody>	
				<tr>
						<k>ParkingServiceGui/ParkManagerService </k>
						
					<td style="width:50%" >
						
						<br> The interaction follow the request/response model because when the client send a command the application must answer with helpful informations (e.g. SLOTNUM, TOKENID...)
					</td>
					<td>
						<pre>

Request carenter : carenter(C)
Reply receipt : receipt(I)

Request notifyIn : notifyIn(N)
Reply informIn : informIn(S)

Request pickup : pickup(TOKENID)
Reply ok : ok(O)

Context ctxparkingarea ip [host="localhost" port=8021]

QActor parkingservicegui context ctxparkingarea{ 
	...
	request parkmanagerservice -m notifyIn : notifyIn(A) 
	...
	request parkmanagerservice -m carenter : carenter ($SLOTNUM)
	...
	request parkmanagerservice -m pickup : pickup($TOKENID)
}
QActor parkmanagerservice context ctxparkingarea{ 
	...
	replyTo notifyIn with informIn : informIn($SLOTNUM)
	...
	replyTo carenter with receipt : receipt($TOKENID)
	...
	replyTo pickup with ok : ok($OUTFREE)
}

					    </pre>
					</td>
					</tr>
				</tbody>
			</table>
			<br>				
			<table>
				<tbody>
				
<br><div > The components communication parkManagerServic/Transport-trolley and Transport-trolley/BasicRobot are described in <a href="https://htmlpreview.github.io/?https://github.com/noemival/ParkManagerService_2021/blob/main/it.unibo.parkManagerService/it.unibo.sprint1/userdocs/sprint1.html" target="web"> sprint1.html</a> </div>
<br>
<div class="remark">
The executable model is the following file: <a href="https://raw.githubusercontent.com/noemival/ParkManagerService_2021/main/it.unibo.parkManagerService/it.unibo.sprint2/src/sprint2.qak"target="web">sprint2.qak</a></p>				
</div>	


<h2>Testplan</h2>
		<p><ks>Testplan</ks>: we should check if the <a href="https://raw.githubusercontent.com/noemival/ParkManagerService_2021//main/it.unibo.parkManagerService/it.unibo.sprint2/src/utility/Slotnum.kt"target="web">Slotnum.kt</a> return the correct number (SLOTNUM from 1 to 6) or all the slot are occupied (SLOTNUM 0) . 
			<br><br> The code is the following file:  <a href="https://raw.githubusercontent.com/noemival/ParkManagerService_2021/main/it.unibo.parkManagerService/it.unibo.sprint2/test/it/unibo/sprint2/TestPlan1.kt"target="web">TestPlan.kt</a></p>

		<br> To realize an authomatized test we will use JUNIT.
<h2>Project</h2> 

<h4>WebApplicationPms</h4>
<table>
				<tbody>	
					<tr>
						<td style="width:50%" >
							The WebApplicationPms will be a system of actors and other components that implements the required automation functions. It is a distributed service accessible via HTTP:
<pre>http://localhost:8081</pre> 


 The WebApplication is in the following folder: <a href="https://github.com/noemival/ParkManagerService_2021/tree/main/it.unibo.parkManagerService/it.unibo.sprint2/it.unibo.WebApplicationPms"target="web">it.unibo.WebApplicationPms</a>
 </td>
						<td>						
							<center><img src="img/WebApplicationParkManagerService2.png" alt="mappa" width="70%" ></center> 
						</td>
					
				</tr>
			</tbody>
		</table>
<h6>ControllerPms</h6>
		<table>
				<tbody>	
					<tr>
						<td style="width:50%" >
							The ControllerPMS represents the WebApplication controller that responsible for processing incoming requests, preparing a model, and returning the view to be rendered as a response.
							<br>It defines an API with the purpose of creating a standard communication so that external components can communicate with our application and without knowing its implementation aspects.<br>
							With the respect of clean architecture the ControllerPMS should implement the view managing of the Web application.
							<br> The ControllerPms is the following file: <a href="https://raw.githubusercontent.com/noemival/ParkManagerService_2021/main/it.unibo.parkManagerService/it.unibo.sprint2/it.unibo.WebApplicationPms/src/main/kotlin/it/unibo/webApplicationPms/ControllerPms.kt"target="web">ControllerPms.kt</a></p>

						</td>
						<td  style="width:50%">
</pre>
<pre>
	<kc>//example of implementation</kc>
  @RequestMapping("/carenter", method = arrayOf(RequestMethod.GET))
    fun carenter(button: Button, slotnum: Slotnum): String {
        var slot = getSlotNum()
        if (!slot.equals("0")) {
            button.enterdisabled = true
            slotnum.slotnum = slot.toInt()
            println(slotnum.slotnum)
        } else {
            button.enterdisabled = false
        }
        return "carenter.html"
    }

     <kc>// used to connecting the WebApplication to the service </kc>
 fun createconnection(messageId: String, content: String): String{ 
        connToPms = connQakBase.create(ConnectionType.TCP)
        connToPms.createConnection()
        val msg = MsgUtil.buildRequest("parkmanagerserviceProxy", messageId, content, qakdestination)
        answer = connToPms.requestWithRensponse(msg)
        print(answer)
        return answer
    }
</pre>				</td>
					
				</tr>
			</tbody>
		</table>
<h6>ParkServiceGui</h6>
			
			<table>
					<tbody>
						<tr>
							<td>
								The ParkServiceGui will be a series of responsive HTML pages with the aim to show what operations the client could be. 
								<li><kn>parking phase:</kn>it is composed by two pages:
									<ul>
										<li>notify in: an html page with a button "notifyIn" pressed by the user to inform the system his intrest to use the service.</li>
										<li>carenter: an html page with a input form where the client should put his email and a button pressed by the user to inform the system that the robot could take the car. The system will use the email to send to the user the link for go to the pick up phase.
										</li>
										</ul>
										<li><kn>pickup phase:</kn> it is composed by one page and it is accessible only using the email sending previously. There is only one button "pickup" used to inform the system that the client want take its car. If the system cannot process the command it will inform the client to try later.   
								The EmailService was implemented to guarantee the right correlation between client and his TOKENID. If the client picked up his car the system is able to recognised and avoid the client to use two times the same link. 
							</td>
							<td style="width: 55%">
					
					 <center><img src="./img/htmlpages.png" alt="ParkingServiceGui" width="100%" ></center> 
							</td>
						</tr>
					</tbody>
				</table> 	


<h3>Logical Architecture</h3>
<table>	
		<td style="width:50%" >
				<center><img src="img/architettura_logica2_project.png" alt="mappa" width="45%" ></center> 
		</td>
	</table>
<div class="remark">
The QActor excecutable model after project phase is the following file: <a href="https://raw.githubusercontent.com/noemival/ParkManagerService_2021/main/it.unibo.parkManagerService/it.unibo.sprint2/src/sprint2_project.qak"target="web">sprint2_project.qak</a></p>	
</div>
<h2>Deployment</h2>
	
The project is located in the repository: <a href="https://github.com/noemival/ParkManagerService_2021/tree/main/it.unibo.parkManagerService"target="web">https://github.com/noemival/ParkManagerService_2021/tree/main/it.unibo.parkManagerService</a></p>

<h2>Testing</h2>

This functional test want to verify the correct implementation of the requirements specified in this sprint. In particular, the requirements were verified:
<ul>
<li>NotifyIn: notify my interest in entering my auto in the parking-area</li>
<li>CarEnter: press a CARENTER button on the ParkServiceGUI thus the car cod be transported by the trolley to reach the correct slot </li>
<li>Pickup: submit the request to pick up my car.</li>
</ul>
To verify that the system goes into the expected states (acceptIn, handleCarEnter, acceptOut) an observer has been created with the aim of capturing the changing states  of the parkmanagerservice actor.
Since the requirements are linked together, they will be tested following a specific order:
<ol>
<li>NotifyIn</li>
<li>CarEnter</li>
<li>Pickup.</li>
</ol>

	<br><br> The code is the following file:  <a href="https://raw.githubusercontent.com/noemival/ParkManagerService_2021/main/it.unibo.parkManagerService/it.unibo.sprint2/testing/Testing.kt"target="web">Testing.kt</a></p>

	
<h3>SPRINT REVIEW</h3> 



<!-- USEFUL
<table style="width:100%" border="1">
<tr>
<td style="width:50%">
</td>
<td></td>
</tr>
</table>
-->
	      	
<br/><br/> 	
</div>  

<div style="background-color:rgba(86, 56, 253, 0.9); width:60%;text-align:left;color:white">
By studentName email: antonio.iacobelli@studio.unibo.it  
<img src="./img/antonioIacobelli.jpg" alt="mbot" width="15%" height="15%">
</div> 
<br>
<div style="background-color:rgba(86, 56, 253, 0.9); width:60%;text-align:left;color:white">
By studentName email: noemi.valentini5@studio.unibo.it  
<img src="./img/noemiValentini.jpg" alt="mbot" width="15%" height="15%">
</div> 
</body>
</html>
